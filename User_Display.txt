package tvprogram;

import java.awt.BorderLayout;
import java.awt.EventQueue;

import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;
import javax.swing.table.DefaultTableModel;

import tvprogram.User_Display;
import tvprogram.Login;
import tvprogram.dbcon;

import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.JButton;
import java.awt.Font;
import java.awt.event.ActionListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.awt.event.ActionEvent;
import javax.swing.JScrollPane;

public class User_Display extends JFrame {

	private JPanel contentPane;
	private JTextField TF_search;
	private JTable Table_program;
	private JScrollPane scrollpane;
	private JButton btn_clear, btn_logout, btn_search, btn_inquiry, btn_chart, btn_information ; 
	
	private String driver = "com.mysql.jdbc.Driver";
	private String url = "jdbc:mysql://localhost/program?useUnicode=true&characterEncoding=utf8";
	private String id = "root";
	private String password = "apmsetup";
	
	private Connection con = null;
	private ResultSet rs = null;
	private Statement st = null;
	private PreparedStatement ps;
	
	private String Columns[] = {"프로그램번호", "방송국", "장르", "프로그램", "시청률"};
	private DefaultTableModel model = new DefaultTableModel(Columns, 0);
	
	private String[] YES_NO = {"예", "아니오"};
	
	public static void main(String[] args) {
		new User_Display();
	}
	
	
	public void Show_Information() {
		String query = "SELECT * FROM tvprogram";
		
		try {
			Class.forName(driver);
			con = DriverManager.getConnection(url, id, password);
			ps = con.prepareStatement(query);
			rs = ps.executeQuery();

			while(rs.next()) {
				model.addRow(new Object[]{rs.getString("P_num"), rs.getString("broadcast_name"), 
						rs.getString("genre"), rs.getString("program_name"),rs.getString("ratings")});
			}
			
		} catch (Exception e) {
			System.out.println("오류" + e);
		}
	}



	public User_Display() {
		Show_Information();
		setTitle("\uC0AC\uC6A9\uC790 \uBAA8\uB4DC");
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setBounds(100, 100, 950, 500);
		contentPane = new JPanel();
		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
		contentPane.setLayout(null);
		setContentPane(contentPane);
		
		TF_search = new JTextField();
		TF_search.setBounds(0, 10, 173, 46);
		contentPane.add(TF_search);
		TF_search.setColumns(10);
		
		JButton btn_search = new JButton("\uAC80\uC0C9");

		Table_program = new JTable(model);
		
		//scrollPane.setViewportView(Table_program);
		JScrollPane scrollPane = new JScrollPane(Table_program);
		scrollPane.setBounds(240, 10, 682, 416);
		contentPane.add(scrollPane);
//		st = con.createStatement();
//		ResultSet srs = st.executeQuery("select P_num, broadcast_name, genre, program_name, ratings");
//		printData(srs, "P_num", "broadcast_name","genre","program_name","ratings");
		
		btn_search.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				String search = TF_search.getText();
				PreparedStatement ps_search;

				try {
					
				ps_search = con.prepareStatement("SELECT * FROM tvprogram WHERE P_num LIKE ? OR broadcast_name LIKE ? OR genre LIKE ? OR program_name LIKE ? OR ratings LIKE ?");
				ps_search.setString(1, "%" + search + "%");
				ps_search.setString(2, "%" + search + "%");
				ps_search.setString(3, "%" + search + "%");
				ps_search.setString(4, "%" + search + "%");
				ps_search.setString(5, "%" + search + "%");

				rs = ps_search.executeQuery();

				System.out.println(ps_search);
				
				model.setRowCount(0);
				
				while(rs.next()) {
					model.addRow(new Object[]{rs.getString("P_num"), rs.getString("broadcast_name"), rs.getString("genre"), rs.getString("program_name"),rs.getString("ratings")});
				}
				
				
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
		});
		btn_search.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_search.setBounds(0, 69, 173, 37);
		contentPane.add(btn_search);
		
		JButton btn_chart = new JButton("\uD3B8\uC131\uD45C\uC870\uD68C");
		btn_chart.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				new tvGuide_UI();
				
			}
		});
		btn_chart.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_chart.setBounds(0, 163, 173, 37);
		contentPane.add(btn_chart);
		
		JButton btn_inquiry = new JButton("\uBB38\uC758\uD558\uAE30");
		btn_inquiry.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
			}
		});
		btn_inquiry.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_inquiry.setBounds(0, 210, 173, 37);
		contentPane.add(btn_inquiry);
		btn_inquiry.addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				new inquiryUi();
				
			}
		});
		
		JButton btn_information = new JButton("\uB0B4\uC815\uBCF4");
		btn_information.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_information.setBounds(0, 257, 173, 37);
		contentPane.add(btn_information);
		
		JButton btn_logout = new JButton("\uB85C\uADF8\uC544\uC6C3");
		btn_logout.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				int result = JOptionPane.showOptionDialog(null, "로그아웃 하시겠습니까?", "LOGOUT", JOptionPane.YES_NO_CANCEL_OPTION, JOptionPane.INFORMATION_MESSAGE, null, YES_NO, null);
                if(result == JOptionPane.YES_OPTION){
                	JOptionPane.showMessageDialog(null, "로그아웃 되셨습니다!", "LOGOUT", JOptionPane.INFORMATION_MESSAGE);
                	dispose();
                	new Login();
                }
			}
		});
		btn_logout.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_logout.setBounds(0, 304, 173, 37);
		contentPane.add(btn_logout);
		
		JButton btn_clear = new JButton("\uAC80\uC0C9 \uCD08\uAE30\uD654");
		btn_clear.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				int result = JOptionPane.showOptionDialog(null, "상태를 초기화하시겠습니까?", "상태 초기화", JOptionPane.YES_NO_CANCEL_OPTION, JOptionPane.INFORMATION_MESSAGE, null, YES_NO, null);
				 if(result == JOptionPane.YES_OPTION) 
				    {
				    	JOptionPane.showMessageDialog(null, "상태가 초기화되었습니다!", "완료", JOptionPane.INFORMATION_MESSAGE);
				    	TF_search.setText("");
				    	model.setRowCount(0);
				    	Show_Information();
				    }
			}
		});
		btn_clear.setFont(new Font("굴림", Font.PLAIN, 16));
		btn_clear.setBounds(0, 116, 173, 37);
		contentPane.add(btn_clear);
		
		
		
		
		setVisible(true);
		}
	}
